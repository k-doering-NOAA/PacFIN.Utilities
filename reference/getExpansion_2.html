<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Expand PacFIN trip samples to catches — getExpansion_2 • PacFIN.Utilities</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Expand PacFIN trip samples to catches — getExpansion_2"><meta property="og:description" content="The second-stage expansion calculates the
per-year and stratification (e.g., gear group) total catch
divided by the sampled catch and appends it to the input data as
Expansion_Factor_2."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PacFIN.Utilities</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Expand PacFIN trip samples to catches</h1>
    
    <div class="hidden name"><code>getExpansion_2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The second-stage expansion calculates the
per-year and stratification (e.g., gear group) total catch
divided by the sampled catch and appends it to the input data as
<code>Expansion_Factor_2</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">getExpansion_2</span><span class="op">(</span></span>
<span>  <span class="va">Pdata</span>,</span>
<span>  <span class="va">Catch</span>,</span>
<span>  Units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MT"</span>, <span class="st">"LB"</span><span class="op">)</span>,</span>
<span>  Convert <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maxExp <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">stratification.cols</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">savedir</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Pdata</dt>
<dd><p>A data frame of biological samples
originating from the
Pacific Fishieries Information Network (PacFIN) data warehouse,
which originated in 2014. Data are pulled using sql calls, see
<code><a href="PullBDS.PacFIN.html">PullBDS.PacFIN</a>()</code>.</p></dd>


<dt>Catch</dt>
<dd><p>A dataframe of catch data, in pounds or in metric tonnes.</p></dd>


<dt>Units</dt>
<dd><p>The units of the <code>Catch</code> data frame, see
<code>measurements::conv_unit_options[["mass"]]</code>
for options. Typical units are metric tonnes (e.g., <code>"metric_ton"</code>)
because that is the unit used in Stock Synthesis, but
expansions are done in pounds because fish weights are in pounds.
Thus, catches also need to be in pounds and will be converted as such.</p></dd>


<dt>Convert</dt>
<dd><p>A deprecated argument that is now set to <code>NULL</code>.
Previously, it was a logical that defined if the Catch should be converted from
metric tonnes to pounds, where <code>TRUE</code> is now the same as setting
<code>Units = "MT"</code> and <code>FALSE</code>, which was the default, would be
<code>Units = "LB"</code>. Normally, one would have their catch in metric tonnes,
i.e., <code>Convert = TRUE</code> or <code>Units = "MT"</code>,
such that it can be used within Stock Synthesis.
todo: remove this input argument</p></dd>


<dt>maxExp</dt>
<dd><p>The maximum expansion factor
(either a number or a quantile) for building expansions.
Typically, the default is 0.95.
Set <code>maxExp = Inf</code> to see largest values.</p></dd>


<dt>stratification.cols</dt>
<dd><p>A vector of column names in <code>Pdata</code> that you want
to use as strata. These will match the way in which the catches are transformed
from long to wide prior to inputting them into this function. If you leave
this argument empty, then <code>Pdata</code> must already have a column named
<code>stratification</code>. The function will look in the column names of the <code>Catch</code>
data to determine the appropriate separator to use between columns when
pasting the words together, which is done using <a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a> and <a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a>.
Historically, it was mandatory to make this column yourself, but in 2021,
this input argument was added to reduce the number of extraneous calls that
were needed between functions.
You can use as many levels of stratification as you want except year because
it is already included in the call to <a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">stats::aggregate</a>.</p></dd>


<dt>verbose</dt>
<dd><p>A logical value specifying if output should be written
to the screen or not. Good for testing and exploring your data but
can be turned off when output indicates errors.
The printing doesn't affect any of the returned objects, instead,
printing makes it easier to see if the data has errors and what was
done to rectify them in the given function.
Sorry, but the default is to always print to the screen,
i.e., <code>verbose = TRUE</code>, so you do not miss out on anything.
This is standard practice for packages in the pfmc-assessments organization.</p></dd>


<dt>savedir</dt>
<dd><p>A file path to the directory where the results will be saved.
The default is the current working directory.
The path can be relative or absolute.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>The input PacFIN dataset, with column <code>Expansion_Factor_2</code> appended.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Find the catch for each year and grouping in <code>Catch</code> and divide by the
pounds of fish that were collected for sampling for that same year and
grouping. Sampled biomass is stored in <code>All_Trips_Sampled_Lbs</code>, which is
the sum of Trip_Sampled_Lbs across sample numbers.
Catches were already stratified (i.e., summed by group placed in a column
for a given year or row). Catches are converted to pounds prior to dividing.
Thus, per-stratum Expansion_Factor_2 is the catch / sampled catch.</p>
    </div>
    <div id="expansion">
    <h2>Expansion</h2>
    

<ul><li><p>Age data are expanded separately from lengths.</p></li>
<li><p>WA fish are generally only expanded using Expansion_Factor_2.</p></li>
<li><p>Other expansions are the product of Expansion_Factor_1 * Expansion_Factor_2</p></li>
<li><p>For age-at-length comps, set Final_Expansion_Factor to 1 because
each fish represents only itself.</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code>getExpansion_2</code> is ran after <a href="getExpansion_1.html">getExpansion_1</a> using the
returned data frame.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Andi Stephens</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Kelli F. Johnson, Andi Stephens.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

